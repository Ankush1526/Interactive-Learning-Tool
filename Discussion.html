<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discussion Forum</title>
    <style>
        body {
            justify-content: center;
            align-items: center; 
            height: 100vh;
            margin: 0;
            font-family: 'Josefin Sans', sans-serif;
            background-color: rgb(59, 53, 53);
            color: white;
        }
        a {
            text-decoration: none;
        }
        input {
            height: 35%;
            width: 40%;
        }
        a:visited {
            color: white;
        }
        a:hover {
            color: red;
        }
        a:active {
            color: rgb(251, 251, 163);
        }
        .bdwa {
            height: 5%;
            width: 10%;
            display: inline;
            background-color: rgb(59, 53, 53);
            border-bottom-left-radius: 50%;
            float: right;
        }
        .container-fluid {
            margin-top: 0%;
            background-color: rgb(59, 53, 53);
            color: aliceblue;
        }  
        .navbar {
            height: 10vh;
            margin-top: 0;
            background-color: rgb(44, 40, 40);
        }
        input {
            color: white;
            width: 10%;
        } 
        ul {
            list-style-type: none;
        }
        li {
            font-style: oblique;
            justify-content: center;
            font-size: larger;
            margin-top: 9%;
            margin-left: 17%;  
        }
        .container-fluid img {
            border-radius: 100%;
            border-bottom-right-radius: 10%;
            height: 5%;
            width: 6%;
        }
        
        /* Discussion Forum Styles */
        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #444;
            border-radius: 10px;
        }
        
        .comment-box {
            margin-bottom: 20px;
        }
        
        .comment-box textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #666;
            background-color: #333;
            color: white;
            margin-bottom: 10px;
        }
        
        .comment-box button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .comment-box button:hover {
            background-color: #0056b3;
        }
        
        .comments-section {
            margin-top: 20px;
        }
        
        .comment {
            background-color: #555;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .comment strong {
            color: #4CAF50;
        }
        
        .comment p {
            margin: 10px 0;
        }
        
        .comment small {
            color: #aaa;
            font-size: 0.8em;
        }
        
        .like-btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-top: 5px;
        }
        
        .like-btn:hover {
            background-color: #555;
        }
        
        .alert {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .alert-warning {
            background-color: #ffc107;
            color: #333;
        }
        
        .alert-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .alert-danger {
            background-color: #dc3545;
            color: white;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<nav class="navbar navbar-expand-lg custom-navbar">
  <div class="container-fluid">
    <img src="newlogo.jpg">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="try.html">HOME</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link" href="about.html">ABOUT</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link" href="Discussion.php">Discussion</a>
              </li>
              <li class="nav-item">
                  <a class="nav-link" href="Teams.html">TEAMS</a>
              </li>
              <li class="nav-item d-flex align-items-center">
                <div id="userAuthSection">
                    <!-- This will be populated by JavaScript -->
                    <a class="nav-link" href="#" id="loginLink">LOGIN</a>
                </div>
            </li>
          </ul>
          <form class="d-flex" role="search">
              <input class="form-control me-2" type="search" placeholder="Search here" aria-label="Search" style="border-top-left-radius: 15%; border-bottom-right-radius: 15%; background-color:  rgb(0, 0, 0); color: rgb(240, 5, 5); font-size: 100%;box-shadow: 10%;">
              <button class="btn btn-outline-success" type="submit">Search</button>
          </form>
      </div>
  </div>
</nav>

<div class="container">
    <h2>Discussion Forum</h2>
    <div id="authAlert" class="alert alert-warning" style="display: none;">Please login to post comments.</div>
    <div class="comment-box" id="commentBox" style="display: none;">
        <textarea id="commentInput" rows="3" placeholder="Write a comment..."></textarea>
        <button onclick="addComment()">Post Comment</button>
    </div>
    <div class="comments-section" id="commentsSection">
        <!-- Comments will load here -->
    </div>
</div>

<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content" style="background-color: #444; color: white;">
      <div class="modal-header">
        <h5 class="modal-title" id="loginModalLabel">Login</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="loginForm">
          <div class="mb-3">
            <label for="username" class="form-label">Username</label>
            <input type="text" class="form-control" id="username" required style="background-color: #333; color: white;">
          </div>
          <button type="submit" class="btn btn-primary">Login</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
// User session management
let currentUser = localStorage.getItem('forumUser') || null;

// Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    updateAuthUI();
    fetchComments();
    
    // Setup login form
    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const username = document.getElementById('username').value.trim();
        if (username) {
            currentUser = username;
            localStorage.setItem('forumUser', username);
            updateAuthUI();
            fetchComments();
            bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
        }
    });
    
    // Setup login link
    document.getElementById('loginLink').addEventListener('click', function(e) {
        e.preventDefault();
        if (currentUser) {
            // Logout
            currentUser = null;
            localStorage.removeItem('forumUser');
            updateAuthUI();
            fetchComments();
        } else {
            // Show login modal
            new bootstrap.Modal(document.getElementById('loginModal')).show();
        }
    });
});

function updateAuthUI() {
    const authAlert = document.getElementById('authAlert');
    const commentBox = document.getElementById('commentBox');
    const loginLink = document.getElementById('loginLink');
    
    if (currentUser) {
        authAlert.style.display = 'none';
        commentBox.style.display = 'block';
        loginLink.textContent = 'LOGOUT (' + currentUser + ')';
    } else {
        authAlert.style.display = 'block';
        commentBox.style.display = 'none';
        loginLink.textContent = 'LOGIN';
    }
}

// Comment management
function addComment() {
    if (!currentUser) {
        alert("Please login to post comments.");
        return;
    }

    const commentText = document.getElementById("commentInput").value.trim();
    if (!commentText) {
        alert("Please enter a comment");
        return;
    }

    // Get existing comments or initialize empty array
    const comments = JSON.parse(localStorage.getItem('forumComments') || '[]');
    
    // Add new comment
    comments.push({
        id: Date.now(),
        username: currentUser,
        comment: commentText,
        created_at: new Date().toISOString(),
        likes: 0
    });
    
    // Save back to localStorage
    localStorage.setItem('forumComments', JSON.stringify(comments));
    
    // Clear input and refresh comments
    document.getElementById("commentInput").value = "";
    fetchComments();
}

function fetchComments() {
    const comments = JSON.parse(localStorage.getItem('forumComments') || '[]');
    const section = document.getElementById("commentsSection");
    
    section.innerHTML = "";
    
    if (comments.length === 0) {
        section.innerHTML = '<div class="alert alert-info">No comments yet. Be the first to comment!</div>';
        return;
    }
    
    // Sort by newest first
    comments.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
    
    comments.forEach(comment => {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `
            <strong>${comment.username}</strong>
            <p>${comment.comment}</p>
            <small>${new Date(comment.created_at).toLocaleString()}</small>
            <button class="like-btn" onclick="likeComment(${comment.id}, this)">Like <span>${comment.likes}</span></button>
        `;
        section.appendChild(div);
    });
}

function likeComment(commentId, button) {
    if (!currentUser) {
        alert("Please login to like comments.");
        return;
    }
    
    const comments = JSON.parse(localStorage.getItem('forumComments') || '[]');
    const comment = comments.find(c => c.id === commentId);
    
    if (comment) {
        comment.likes = (comment.likes || 0) + 1;
        localStorage.setItem('forumComments', JSON.stringify(comments));
        
        // Update the like count display
        const span = button.querySelector('span');
        span.textContent = comment.likes;
    }
}
</script>

</body>
</html>